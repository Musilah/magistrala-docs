
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Magistrala IoT System">
      
      
      
        <link rel="canonical" href="https://docs.magistrala.abstractmachines.fr/authorization/">
      
      
        <link rel="prev" href="../authentication/">
      
      
        <link rel="next" href="../security/">
      
      
      <link rel="icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Authorization - Magistrala</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#domains" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Magistrala" class="md-header__button md-logo" aria-label="Magistrala" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Magistrala
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authorization
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/absmach/magistrala" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Magistrala" class="md-nav__button md-logo" aria-label="Magistrala" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    Magistrala
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/absmach/magistrala" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entities
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Authorization
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Authorization
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domains" class="md-nav__link">
    <span class="md-ellipsis">
      Domains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain Entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-entities-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain Entities Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-thing-connectdisconnect" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Thing Connect/Disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-group-relation" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Group Relation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-group-relation" class="md-nav__link">
    <span class="md-ellipsis">
      Group Group Relation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-entities-relation-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities Relation Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-domain-relationship" class="md-nav__link">
    <span class="md-ellipsis">
      User Domain Relationship
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Domain Relationship">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Administrator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-editor" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Editor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Viewer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-member" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Member
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokens-and-domain-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Tokens and Domain Tokens
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokens and Domain Tokens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-passing-domain_id-while-obtaining-new-token" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Passing domain_id while obtaining new token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-get-new-access-and-refresh-token-through-the-refresh-endpoint-by-passing-domain_id" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Get new access and refresh token through the refresh endpoint by passing domain_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assign-users-to-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Assign Users to Domain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unassign-users-from-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Unassign Users from Domain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-entities-relationship" class="md-nav__link">
    <span class="md-ellipsis">
      User Entities Relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#groups-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Groups Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Group Administrator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-editor" class="md-nav__link">
    <span class="md-ellipsis">
      Group Editor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      Group Viewer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-viewer-with-channel-thing" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Viewer with Channel &amp; Thing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-domain-members-with-group-channel-thing" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Domain Members with Group, Channel &amp; Thing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-registration" class="md-nav__link">
    <span class="md-ellipsis">
      User Registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magistrala-personal-access-token-pat-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Magistrala Personal Access Token (PAT) Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Magistrala Personal Access Token (PAT) Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pat-overview" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pat-fields" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Scope Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-scope-json" class="md-nav__link">
    <span class="md-ellipsis">
      Example Scope JSON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pat-endpoint-operations" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Endpoint Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-authorization-process" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Authorization Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Authorization Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-of-authorization-failure" class="md-nav__link">
    <span class="md-ellipsis">
      Example of Authorization Failure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../messaging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Messaging
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../edge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Edge
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../certs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LoRa
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../opcua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPC-UA
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../provision/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Provision
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../twins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twins
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tracing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tracing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer's Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benchmark
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="/blogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domains" class="md-nav__link">
    <span class="md-ellipsis">
      Domains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain Entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-entities-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain Entities Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-thing-connectdisconnect" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Thing Connect/Disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-group-relation" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Group Relation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-group-relation" class="md-nav__link">
    <span class="md-ellipsis">
      Group Group Relation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-entities-relation-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Entities Relation Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-domain-relationship" class="md-nav__link">
    <span class="md-ellipsis">
      User Domain Relationship
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Domain Relationship">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Administrator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-editor" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Editor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Viewer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-member" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Member
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokens-and-domain-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Tokens and Domain Tokens
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokens and Domain Tokens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-passing-domain_id-while-obtaining-new-token" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Passing domain_id while obtaining new token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-get-new-access-and-refresh-token-through-the-refresh-endpoint-by-passing-domain_id" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Get new access and refresh token through the refresh endpoint by passing domain_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assign-users-to-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Assign Users to Domain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unassign-users-from-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Unassign Users from Domain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-entities-relationship" class="md-nav__link">
    <span class="md-ellipsis">
      User Entities Relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#groups-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Groups Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Group Administrator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-editor" class="md-nav__link">
    <span class="md-ellipsis">
      Group Editor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      Group Viewer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-viewer-with-channel-thing" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Viewer with Channel &amp; Thing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-domain-members-with-group-channel-thing" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Domain Members with Group, Channel &amp; Thing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-registration" class="md-nav__link">
    <span class="md-ellipsis">
      User Registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magistrala-personal-access-token-pat-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Magistrala Personal Access Token (PAT) Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Magistrala Personal Access Token (PAT) Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pat-overview" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pat-fields" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Scope Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-scope-json" class="md-nav__link">
    <span class="md-ellipsis">
      Example Scope JSON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pat-endpoint-operations" class="md-nav__link">
    <span class="md-ellipsis">
      PAT Endpoint Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-authorization-process" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Authorization Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Authorization Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-of-authorization-failure" class="md-nav__link">
    <span class="md-ellipsis">
      Example of Authorization Failure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Authorization</h1>

<p>Magistrala allows for fine-grained control over user permissions, taking into account hierarchical relationships between entities domains, groups, channels, and things. The structure and functionality of an authorization system implemented using <a href="https://github.com/authzed/spicedb">SpiceDB</a> and its associated <a href="https://authzed.com/docs/reference/schema-lang">schema language</a>. <code>auth</code> service backed by SpiceDB manages permissions for users, domains, groups, channels, and things.</p>
<h2 id="domains">Domains<a class="headerlink" href="#domains" title="Permanent link">#</a></h2>
<p>Domain contains <strong>Things</strong>, <strong>Channels</strong>, and <strong>Groups</strong>. A <strong>User</strong> can be a member of a domain with different types of available relations. This relation provides access control to the entities in the domain.</p>
<h3 id="domain-entities">Domain Entities<a class="headerlink" href="#domain-entities" title="Permanent link">#</a></h3>
<h4 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h4>
<p>In Magistrala, <strong>things</strong>, <strong>channels</strong>, and <strong>groups</strong> are inherently associated with one particular domain. This means that every <strong>group</strong>, including its sub-groups, every <strong>thing</strong>, and every <strong>channel</strong> is owned by and belongs to a specific domain. Domain acts like a kind of namespace.</p>
<pre class="mermaid"><code>graph TD
   Do[Domain]
   Gr["Groups + Sub Groups"]
   Th[Things]
   Ch[Channels]

   Do ---&gt;|owns| Gr
   Do ---&gt;|owns| Ch
   Do ---&gt;|owns| Th
</code></pre>
<p>Entities within domains have relationships with other entities in hierarchical structure.</p>
<pre class="mermaid"><code>graph
   subgraph Domain
      direction BT
      Gr[Group]
      Th[Thing]
      SG["Group (Sub Group)"]
      Ch[Channel]

      Th ---&gt;|connects| Ch
      Ch ---&gt;|parent| SG
      Ch ---&gt;|parent| Gr
      SG ---&gt;|parent| Gr
   end
style Domain stroke-width:3px,margin-top:10px,margin-bottom:10px</code></pre>
<h4 id="domain-entities-relations">Domain Entities Relations<a class="headerlink" href="#domain-entities-relations" title="Permanent link">#</a></h4>
<p>Domain holds entities such as <code>groups</code>, <code>channels</code>, and <code>things</code>.
The entities created in a domain don't have any hierarchical structure between them.</p>
<p>Example: In <code>domain_1</code> a user creates the following entities <code>group_1</code>, <code>group_2</code>, <code>thing_1</code>, <code>thing_2</code>, <code>channel_1</code>, <code>channel_2</code>. By default, there is no relation between the entities, until the user assigns a relation between the entities</p>
<pre class="mermaid"><code>graph
   subgraph domain_1
      direction TB
      Gr1["group_1"]
      Gr2["group_2"]

      Th1["thing_1"]
      Th2["thing_2"]


      Ch1["channel_1"]
      Ch2["channel_2"]

   end</code></pre>
<h5 id="channel-thing-connectdisconnect">Channel Thing Connect/Disconnect<a class="headerlink" href="#channel-thing-connectdisconnect" title="Permanent link">#</a></h5>
<p><code>Thing</code> represents a device (or an application) connected to Magistrala that uses the platform for message exchange with other <code>things</code>.</p>
<p><code>Channel</code> is a message conduit between things connected to it. It serves as a message topic that can be consumed by all of the things connected to it.
Things can publish or subscribe to the channel.</p>
<p>Thing and channel can be connected to multiple channels using the following API.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span>http://localhost/connect<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;domain_user_access_token&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{  </span>
<span class="s">  &quot;thing_id&quot;: &quot;&lt;thing_id&gt;&quot;,</span>
<span class="s">  &quot;channel_id&quot;: &quot;&lt;channel_id&gt;&quot;</span>
<span class="s">}  </span>
<span class="s">EOF</span><span class="w"> </span>
</code></pre></div>
<p><em><em>The below diagram shows <code>thing_1</code> is connected to <code>channel_1</code> and <code>channel_2</code> , then <code>thing_2</code> is connected to <code>channel_2</code>. This relationship can be established using the provided request</em></em></p>
<pre class="mermaid"><code>graph
   subgraph domain_1
      direction BT
      Gr1["group_1"]
      Gr2["group_2"]

      Th1["thing_1"]
      Th2["thing_2"]

      Ch1["channel_1"]
      Ch2["channel_2"]


      Th1 ---&gt;|connect| Ch1
      Th1 ---&gt;|connect| Ch2

      Th2 ---&gt;|connect| Ch2
   end</code></pre>
<h5 id="channel-group-relation">Channel Group Relation<a class="headerlink" href="#channel-group-relation" title="Permanent link">#</a></h5>
<p>A group serves as a parent entity that can contain both groups and channels as children. Child groups, in turn, can consist of further child groups or channels, forming a nested hierarchy. Notably, channels, which are distinct entities, cannot have child channels but can connect to multiple things. The concept of parentage signifies the relationship between higher-level entities and their subordinate components. Ancestors in this system refer to entities higher up in the hierarchy, and while a child group can have multiple ancestors, a channel can only belong to a single parent group. This hierarchical arrangement provides a structured and organized framework for managing information within the Magistrala.</p>
<p>Assigning a group as the parent of a channel can be achieved through the following request.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/channels/&lt;channel_id&gt;/groups/assign&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;domain_user_access_token&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;group_ids&quot; : [ &quot;&lt;group_id_1&gt;&quot;, &quot;&lt;group_id_2&gt;&quot; ]</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><em><em>The diagram below illustrates the parent relationship between <code>channel_1</code> and <code>channel_2</code> with <code>group_2</code>. This relationship can be established using the provided request.</em></em></p>
<pre class="mermaid"><code>graph
   subgraph domain_1
      direction BT
      Gr1["group_1"]
      Gr2["group_2"]

      Th1["thing_1"]
      Th2["thing_2"]

      Ch1["channel_1"]
      Ch2["channel_2"]


      Th1 ---&gt;|connect| Ch1
      Th1 ---&gt;|connect| Ch2

      Th2 ---&gt;|connect| Ch2

      Ch1 ---&gt;|parent| Gr2
      Ch2 ---&gt;|parent| Gr2
   end</code></pre>
<h5 id="group-group-relation">Group Group Relation<a class="headerlink" href="#group-group-relation" title="Permanent link">#</a></h5>
<p>Groups can establish a parent-child relationship with other groups. The children groups are sub-group and they can also have children groups in nested fashion</p>
<p>Assigning a group as the parent to another group can be achieved through the following request.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/groups/&lt;parent_group_id&gt;/groups/assign&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;domain_user_access_token&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;group_ids&quot;: [&quot;&lt;child_group_id_1&gt;&quot;,&quot;&lt;child_group_id_2&gt;&quot;]</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><em><em>The diagram below illustrates the parent relationship between <code>group_1</code> and <code>group_2</code>. This relationship can be established using the provided request.</em></em></p>
<pre class="mermaid"><code>graph
   subgraph domain_1
      direction BT
      Gr1["group_1"]
      Gr2["group_2"]

      Th1["thing_1"]
      Th2["thing_2"]

      Ch1["channel_1"]
      Ch2["channel_2"]


      Th1 ---&gt;|connect| Ch1
      Th1 ---&gt;|connect| Ch2

      Th2 ---&gt;|connect| Ch2

      Ch1 ---&gt;|parent| Gr2
      Ch2 ---&gt;|parent| Gr2

      Gr2 ---&gt;|parent| Gr1
   end</code></pre>
<h5 id="domain-entities-relation-examples">Domain Entities Relation Examples<a class="headerlink" href="#domain-entities-relation-examples" title="Permanent link">#</a></h5>
<p>An example group with channels, things, and groups (sub-groups) within the domain.
Groups have parent-child relationships, forming a hierarchy where top-level groups (<code>group_1</code> and <code>group_2</code>) have groups (sub-groups - <code>group_11</code>, <code>group_12</code>, <code>group_21</code>, and <code>group_22</code>) or channels (<code>channel_2</code>) beneath them.</p>
<pre class="mermaid"><code>graph
   subgraph domain_1
      direction BT
      Gr1["group_1"]
      Gr2["group_2"]

      Gr11["group_11 (Sub Group)"]
      Gr12["group_12 (Sub Group)"]

      Gr21["group_21 (Sub Group)"]
      Gr22["group_22 (Sub Group)"]

      Th1["thing_1"]
      Th2["thing_2"]
      Th3["thing_3"]
      Th4["thing_4"]
      Th5["thing_5"]
      Th6["thing_6"]



      Ch1["channel_1"]
      Ch2["channel_2"]
      Ch3["channel_3"]
      Ch4["channel_4"]

      Gr11 ---&gt;|parent| Gr1
      Gr12 ---&gt;|parent| Gr1

      Ch1 ---&gt;|parent| Gr11
      Th1 ---&gt;|connects| Ch1
      Th5 ---&gt;|connects| Ch1

      Ch2 ---&gt;|parent| Gr1
      Th2 ---&gt;|connects| Ch2

      Gr21 ---&gt;|parent| Gr2
      Ch3 ---&gt;|parent| Gr21
      Th3 ---&gt;|connects| Ch3

      Gr22 ---&gt;|parent| Gr21
      Ch4 ---&gt;|parent| Gr22
      Th4 ---&gt;|connects| Ch4
      Th6 ---&gt;|connects| Ch4
   end</code></pre>
<p>Another example</p>
<pre class="mermaid"><code>graph
  subgraph domain_1
    direction BT

    Gr1["group_1"]

    Gr11["group_11 (Sub Group)"]
    Gr12["group_12 (Sub Group)"]
    Gr13["group_13 (Sub Group)"]


    Th1["thing_1"]
    Th2["thing_2"]
    Th3["thing_3"]
    Th4["thing_4"]
    Th11["thing_11"]
    Th22["thing_22"]
    Th33["thing_33"]

    Ch1["channel_1"]
    Ch2["channel_2"]
    Ch3["channel_3"]
    Ch4["channel_4"]

    Gr11 ---&gt;|parent| Gr1
    Ch4 ---&gt;|parent| Gr1
    Gr12 ---&gt;|parent| Gr11
    Gr13 ---&gt;|parent| Gr12

    Ch1 ---&gt;|parent| Gr11
    Ch2 ---&gt;|parent| Gr12
    Ch3 ---&gt;|parent| Gr13


    Th1 ---&gt;|connects| Ch1
    Th11 ---&gt;|connects| Ch1

    Th2 ---&gt;|connects| Ch2
    Th22 ---&gt;|connects| Ch2
    Th3 ---&gt;|connects| Ch3
    Th33 ---&gt;|connects| Ch3
    Th4 ---&gt;|connects| Ch4

  end</code></pre>
<h2 id="user-domain-relationship">User Domain Relationship<a class="headerlink" href="#user-domain-relationship" title="Permanent link">#</a></h2>
<p>In Magistrala, when a new user registers, they don't automatically have access to domains.
The domain administrator must invite the user to the domain and assign them a role, such as administrator, editor, viewer, or member.</p>
<p>Domain administrator can invite an existing user in Magistrala or invite new users to the domain by e-mail ID.
After the user registers with Magistrala, the user can accept the invitations to the domain.</p>
<p>All the users in Magistrala are allowed to create a new domain.
The user who creates a domain automatically becomes the domain administrator.</p>
<p>Users can have any one of the following relations with a domain</p>
<ul>
<li><a href="#domain-administrator">Administrator</a></li>
<li><a href="#domain-editor">Editor</a></li>
<li><a href="#domain-viewer">Viewer</a></li>
<li><a href="#domain-member">Member</a></li>
</ul>
<p><strong>Let's take the below domain_1 with entities for explaining about user domain relationship.</strong></p>
<p><img alt="domain_users" src="../diagrams/domain_users.svg" /></p>
<h3 id="domain-administrator">Domain Administrator<a class="headerlink" href="#domain-administrator" title="Permanent link">#</a></h3>
<p>Users with administrator relations have full control over all entities (things, channels, groups) within the domain. They can perform actions like creating, updating, and deleting entities created by others. Administrators are also allowed to create their own entities and can view and update the ones they have created.</p>
<p><strong>Example:</strong>
<strong>user_1</strong> is <strong>administrator</strong> of <strong>domain_1</strong>. <strong>user_1 can view all entities created by others and have administrator access to all entities in the domain</strong>.</p>
<p><img alt="domain_users_administrator" src="../diagrams/domain_users_administrator.svg" /></p>
<h3 id="domain-editor">Domain Editor<a class="headerlink" href="#domain-editor" title="Permanent link">#</a></h3>
<p>Users with editor relations have access to update all entities (things, channels, groups) created by others within the domain. Editor are also allowed to create their own entities and can view and update the ones they have created.</p>
<p><strong>Example:</strong>
<strong>user_2</strong> is <strong>editor</strong> of <strong>domain_1</strong>. <strong>user_2 can view all entities and have edit access to groups and channel entities, view access to thing entities in the domain, and also able to create &amp; manage new things, channels &amp; groups</strong>.</p>
<p><img alt="domain_users_editor" src="../diagrams/domain_users_editor.svg" /></p>
<h3 id="domain-viewer">Domain Viewer<a class="headerlink" href="#domain-viewer" title="Permanent link">#</a></h3>
<p>Users with viewer relations have access to view all entities (things, channels, groups) created by others within the domain. Viewer are also allowed to create their own entities and can view and update the ones they have created.</p>
<p><strong>Example:</strong>
<strong>user_3 can only view entities that are created by others in the domain and <span style={{ color:'blue' }}>also able to create &amp; manage new things, channels &amp; groups</span></strong></p>
<p><img alt="domain_users_viewer" src="../diagrams/domain_users_viewer.svg" /></p>
<h3 id="domain-member">Domain Member<a class="headerlink" href="#domain-member" title="Permanent link">#</a></h3>
<p>Users with member relations could not view and no access to entities (things, channels, groups) created by others within the domain. Members are also allowed to create their own entities and can view and update the ones they have created.
Domain members will not have access by default to any of the entities in the Domain, access shall be granted for specific entities by the domain administrator or individual entity administrator.</p>
<p><strong>Example:</strong>
<strong>user_4 , user_5, user_6, user_7, user_8, user_9</strong> is <strong>member</strong> of <strong>domain_1</strong>. <strong>These member relation users can able to create &amp; manage new things, channels &amp; groups in the domain. They can have access to the entities to which they have a relation in the domain. They could not view and manage other entities to which they don't have any relation in domain</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note: All other users having administrator, editor, viewer relation with domain will also have member relation inherit with domain, which allows them to create new things, channels &amp; groups.</p>
</div>
<p><img alt="domain_users_member" src="../diagrams/domain_users_member.svg" /></p>
<p>After the user sign-up to Magistrala, the user is allowed to create a new domain or join an existing domain via invitations, without domain user could not create <em>things</em>, <em>channels</em>, <em>groups</em>.</p>
<p>All operations, including creating, updating, and deleting things, channels, and groups, occur at the domain level. For instance, when a user creates a new thing using an access token, the newly created thing automatically becomes associated with a specific domain. The domain information is extracted from the access token. When the user obtains a token, the user should specify the domain for which they want to operate.</p>
<p>So to do operations on a domain, an access token for the domain is required. This can be obtained in two ways which is explained in <a href="#tokens-and-domain-tokens">next section</a>.</p>
<h2 id="tokens-and-domain-tokens">Tokens and Domain Tokens<a class="headerlink" href="#tokens-and-domain-tokens" title="Permanent link">#</a></h2>
<p>JWT token are used in Magistrala for authentication and authorization. The JWT token has domain, exp, iat, iss, sub, type, and user fields.</p>
<p>Example JWT Token:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706544967</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706541367</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;magistrala.auth&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;266d00f8-2284-4613-b732-3bd16e7cf8f2&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>In JWT token, the domain field has <strong>domain ID</strong> and the user field has <strong>user ID</strong>.</p>
<p>If the domain field is empty, then with that JWT token following actions are permitted</p>
<ul>
<li>User profile update</li>
<li>Domain creation &amp; listing,</li>
<li>Accept domain invitations</li>
</ul>
<p>Actions related to the creation, update, and deletion of things, channels, and groups are not permitted, requests will fail in authorization. Magistrala operations related to things, channels, and groups take place in domain level. So for these kinds of operations, a JWT token with a domain field containing the operating domain ID is required.</p>
<p>There are two ways to obtain JWT token for a particular domain</p>
<h3 id="option-1-passing-domain_id-while-obtaining-new-token">Option 1: Passing domain_id while obtaining new token<a class="headerlink" href="#option-1-passing-domain_id-while-obtaining-new-token" title="Permanent link">#</a></h3>
<p><strong>Request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/users/tokens/issue&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;domain_user_access_token&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;identity&quot;: &quot;user1@example.com&quot;,</span>
<span class="s">  &quot;secret&quot;: &quot;12345678&quot;,</span>
<span class="s">  &quot;domain_id&quot;: &quot;903f7ede-3308-4206-89c2-e99688b612f7&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>In this request, if the domain ID is empty or if the field is not added, then in response JWT token will have an empty domain field.</p>
<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiI5MDNmN2VkZS0zMzA4LTQyMDYtODljMi1lOTk2ODhiNjEyZjciLCJleHAiOjE3MDY2MDM0NDcsImlhdCI6MTcwNjU5OTg0NywiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiOTAzZjdlZGUtMzMwOC00MjA2LTg5YzItZTk5Njg4YjYxMmY3XzU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiIsInR5cGUiOjAsInVzZXIiOiI1NzQ4ZGU2OS0yYTY2LTQwZGEtYTgyOS0xYjQ3ZjAyZTlhZGIifQ.c8a8HhVAbkdq_qZnd1DWHtkoNDPQc6XJY6-UcqqCygRR9svjgkwetN3rmIOWPNV5CjPh5lqlzWv1cOLruKBmzw&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiI5MDNmN2VkZS0zMzA4LTQyMDYtODljMi1lOTk2ODhiNjEyZjciLCJleHAiOjE3MDY2ODYyNDcsImlhdCI6MTcwNjU5OTg0NywiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiOTAzZjdlZGUtMzMwOC00MjA2LTg5YzItZTk5Njg4YjYxMmY3XzU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiIsInR5cGUiOjEsInVzZXIiOiI1NzQ4ZGU2OS0yYTY2LTQwZGEtYTgyOS0xYjQ3ZjAyZTlhZGIifQ.SEMvEw2hchsvPYJWqnHMKlUmgjfqAvFcjeCDXyvS2xSGsscEci3bMrUohaJNkNDWzTBiBinV7nEcPrwbxDfPBQ&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="option-2-get-new-access-and-refresh-token-through-the-refresh-endpoint-by-passing-domain_id">Option 2: Get new access and refresh token through the refresh endpoint by passing domain_id<a class="headerlink" href="#option-2-get-new-access-and-refresh-token-through-the-refresh-endpoint-by-passing-domain_id" title="Permanent link">#</a></h3>
<p>In most of the cases user login domain is under determinable. This method will be useful for those kind of cases.</p>
<p><strong>Step 1: Get token without domain ID</strong>
<strong>Request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/users/tokens/issue&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;domain_user_access_token&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;identity&quot;: &quot;user1@example.com&quot;,</span>
<span class="s">  &quot;secret&quot;: &quot;12345678&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiIiLCJleHAiOjE3MDY2MDM1MjYsImlhdCI6MTcwNjU5OTkyNiwiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiIiwidHlwZSI6MCwidXNlciI6IjU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiJ9.Cc2Qj_z3gcUTjDo7lpcUVx9ymnUfClwt28kayHvMhY27eDu1vWMAZb_twQ85pbSlf12juo8P_YJcWKl3rDEokQ&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiIiLCJleHAiOjE3MDY2ODYzMjYsImlhdCI6MTcwNjU5OTkyNiwiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiIiwidHlwZSI6MSwidXNlciI6IjU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiJ9.SiVsctItdR0WFhRbg7omZgR_WDPlLfLF2ov2eqkE1EP8c7RruOEv-KST3xVsohY33t2xevrtorwbjMQsl1YV7Q&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Decoded Access Token:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706603526</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706599926</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;magistrala.auth&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Decoded Refresh Token:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706686326</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706599926</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;magistrala.auth&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>In these tokens, the domain field will be empty. As said earlier, this token can be to for user profile update, domain creation &amp; listing, accept domain invitations</p>
<p><strong>Step 2: List domains users have access</strong>
<strong>Request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>GET<span class="w"> </span><span class="s1">&#39;http://localhost/domains&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;ACCESS_TOKEN_FROM_STEP_1&gt;&quot;</span>
</code></pre></div>
<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;domains&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;903f7ede-3308-4206-89c2-e99688b612f7&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Domain 1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;domain_1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;permission&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;administrator&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;created_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-30T07:30:36.89495Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;updated_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Step 3: Send Request to Refresh endpoint with domain id</strong>
<strong>Request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/users/tokens/refresh&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;REFRESH_TOKEN_FROM_STEP_1&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;domain_id&quot;: &quot;903f7ede-3308-4206-89c2-e99688b612f7&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note: Same request also used for switching between domains.</p>
</div>
<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiI5MDNmN2VkZS0zMzA4LTQyMDYtODljMi1lOTk2ODhiNjEyZjciLCJleHAiOjE3MDY2MDM3MDYsImlhdCI6MTcwNjYwMDEwNiwiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiOTAzZjdlZGUtMzMwOC00MjA2LTg5YzItZTk5Njg4YjYxMmY3XzU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiIsInR5cGUiOjAsInVzZXIiOiI1NzQ4ZGU2OS0yYTY2LTQwZGEtYTgyOS0xYjQ3ZjAyZTlhZGIifQ.3_q4F9CWxmBVjItiE8uR01vlm0du_ISl75E-nfEcc-3IMqHEOLbz1WrDvGbaYcPZ-CQufZuP2j-zqR4lShnu2Q&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJkb21haW4iOiI5MDNmN2VkZS0zMzA4LTQyMDYtODljMi1lOTk2ODhiNjEyZjciLCJleHAiOjE3MDY2ODY1MDYsImlhdCI6MTcwNjYwMDEwNiwiaXNzIjoibWFnaXN0cmFsYS5hdXRoIiwic3ViIjoiOTAzZjdlZGUtMzMwOC00MjA2LTg5YzItZTk5Njg4YjYxMmY3XzU3NDhkZTY5LTJhNjYtNDBkYS1hODI5LTFiNDdmMDJlOWFkYiIsInR5cGUiOjEsInVzZXIiOiI1NzQ4ZGU2OS0yYTY2LTQwZGEtYTgyOS0xYjQ3ZjAyZTlhZGIifQ.KFUEGEx0LZStpokGnQHoMbpPRA5RUH7AR5RHRC46KcBIUoD4EcuWBiSreFwyRc4v-tcbp-CQQaBNGhqYMW4QZw&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Decoded Access Token:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;903f7ede-3308-4206-89c2-e99688b612f7&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706603706</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706600106</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;magistrala.auth&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;903f7ede-3308-4206-89c2-e99688b612f7_5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Decoded Refresh Token:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;903f7ede-3308-4206-89c2-e99688b612f7&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706686506</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1706600106</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;magistrala.auth&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;903f7ede-3308-4206-89c2-e99688b612f7_5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5748de69-2a66-40da-a829-1b47f02e9adb&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="assign-users-to-domain">Assign Users to Domain<a class="headerlink" href="#assign-users-to-domain" title="Permanent link">#</a></h2>
<p>Domain creator becomes administrator of the domain by default. Domain administrator can assign users to a domain with the following relations administrator, editor, viewer, member. The details about these relations are described in this <a href="#user-domain-relationship">section</a></p>
<p>User can be assigned to domain with endpoint <code>/domain/&lt;domain_id&gt;/users/assign</code> with JSON body like below:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;user_ids&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&lt;user_id&gt;&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;relation&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;editor&quot;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>user_ids</strong> : field contains an array of users' IDs</li>
<li><strong>relation</strong> : field contains any one of the following relations <strong>administrator</strong>, <strong>editor</strong>, <strong>viewer</strong>, <strong>member</strong>, The details about these relations are described in this <a href="#user-domain-relationship">section</a></li>
</ul>
<p><strong>Example Request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/domains/903f7ede-3308-4206-89c2-e99688b612f7/users/assign&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w">  </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;user_ids&quot; : [&quot;05dbd66a-ce38-4928-ac86-c1b44909be0d&quot;],</span>
<span class="s">  &quot;relation&quot; : &quot;editor&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<h2 id="unassign-users-from-domain">Unassign Users from Domain<a class="headerlink" href="#unassign-users-from-domain" title="Permanent link">#</a></h2>
<p>User can be unassigned to domain with endpoint <code>/domain/&lt;domain_id&gt;/users/unassign</code> with JSON body like below:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;user_ids&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&lt;user_id&gt;&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;relation&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;editor&quot;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>user_ids</strong> : field contains an array of users' IDs</li>
<li><strong>relation</strong> : field contains any one of the following relations <strong>administrator</strong>, <strong>editor</strong>, <strong>viewer</strong>, <strong>member</strong>, The details about these relations are described in this <a href="#user-domain-relationship">section</a></li>
</ul>
<p><strong>Example request:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/domains/903f7ede-3308-4206-89c2-e99688b612f7/users/unassign&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;user_ids&quot; : [&quot;05dbd66a-ce38-4928-ac86-c1b44909be0d&quot;],</span>
<span class="s">  &quot;relation&quot; : &quot;administrator&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<h2 id="user-entities-relationship">User Entities Relationship<a class="headerlink" href="#user-entities-relationship" title="Permanent link">#</a></h2>
<p>Users assigned to a domain with any relationship (administrator, editor, viewer, member ) will have access to create entities (things, groups, channels).</p>
<p>Domain administrator or individual entity administrator shall grant access to domain member for specific entities.</p>
<h2 id="groups-relations">Groups Relations<a class="headerlink" href="#groups-relations" title="Permanent link">#</a></h2>
<p>Like domains, groups also have four types of relations</p>
<ul>
<li><a href="#group-administrator">Administrator</a></li>
<li><a href="#group-editor">Editor</a></li>
<li><a href="#group-viewer">Viewer</a></li>
</ul>
<h3 id="group-administrator">Group Administrator<a class="headerlink" href="#group-administrator" title="Permanent link">#</a></h3>
<p>Group administrator users have access to update, delete, assign, and unassign to the group and also have access to update, delete, assign, and unassign all of its child entities</p>
<p>From the <a href="#domain-viewer">previous viewer example</a>, let's take <strong>user_3</strong> who has <strong>viewer relation</strong> with <strong>domain_1</strong>, which means <strong>user_3 will be able to view all the entities created by others but cannot make any edits or updates on them.</strong> <strong><span style={{ color:'blue' }}>user_3 will have access to create entities in domain_1 </span></strong></p>
<p><strong>user_3 creates new thing_101, channel_101, and group_101</strong>.</p>
<p><strong>user_3 request to create thing_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/things&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;credentials&quot;: {</span>
<span class="s">    &quot;secret&quot;: &quot;a1ca33c0-367e-402b-a239-ff1255fdc440&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;name&quot;: &quot;thing_101&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><strong>user_3 request to create channel_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/channels&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;name&quot;: &quot;chanel_101&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><strong>user_3 request to create group_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/groups&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;name&quot;: &quot;group_101&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>The user who creates the entity will be the administrator of the entity by default.
So <strong>user_3</strong> is <strong>administrator</strong> of <strong>thing_101, channel_101 and group_101.</strong></p>
<p><img alt="group_users_administrator_1" src="../diagrams/group_users_administrator_1.svg" /></p>
<div class="admonition note">
<p class="admonition-title">user_3 will also have domain viewer relation to thing_101, channel_101, and group_101</p>
</div>
<p>user_3 can make these entities (thing_101, channel_101, group_101) in a hierarchical structure by assigning relations between entities
Example: Connect thing_101 &amp; channel_101, assign group_101 as parent of channel_101.</p>
<p><strong>user_3 request for connect thing_101 &amp; channel_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/connect&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;thing_id&quot;: &quot;&lt;thing_101_id&gt;&quot;,</span>
<span class="s">  &quot;channel_id&quot;: &quot;&lt;channel_101_id&gt;&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><strong>user_3 request for assign group_101 as parent of channel_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/channels/&lt;channel_101_id&gt;/groups/assign&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;group_ids&quot; : [ &quot;&lt;group_101_id&gt;&quot; ]</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p><img alt="group_users_administrator_2" src="../diagrams/group_users_administrator_2.svg" /></p>
<p><strong>Members of domain 1 will not have access by default to any of the entities in domain 1, access shall be granted for specific entities by domain administrator or individual entity administrator.</strong></p>
<p><strong>Administrator of group_101 (user_3), assigns user_4 with administrator relation.</strong>
<strong>When domain member user_4 becomes an administrator of group_101, user_4 can able to update, delete, assign, and unassign to group_101. Since group_101 has channel_101 and thing_101 as children. The user_5 has administrator access on group_101 child entities channel_101 and thing_101.</strong></p>
<p><strong>user_3 request for assign user_4 as administrator for group_101:</strong></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sSiX<span class="w"> </span>POST<span class="w"> </span><span class="s1">&#39;http://localhost/domains/&lt;DOMINA_1_ID&gt;/users/assign&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;DOMAIN_ACCESS_TOKEN_&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span>&lt;&lt;<span class="w"> </span>EOF
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;user_ids&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;&lt;user_4 ID&gt;&quot;</span><span class="o">]</span>,
<span class="w">  </span><span class="s2">&quot;relation&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;administrator&quot;</span>
<span class="o">}</span>
</code></pre></div>
<p><img alt="group_users_administrator_3" src="../diagrams/group_users_administrator_3.svg" /></p>
<h3 id="group-editor">Group Editor<a class="headerlink" href="#group-editor" title="Permanent link">#</a></h3>
<p>Group editor users have access to view, update, assign, and unassign to the group and also have access to view, update, assign, and unassign all of its child channel and group entities, group editor have only view access to child thing entities in group</p>
<p><strong>Administrator of group_101 (user_3/user_4), assigns user_5 with editor relation.</strong>
<strong>When domain member user_5 becomes an editor of group_101, user_5 can able to update, assign, and unassign to group_101. Since group_101 has channel_101 and thing_101 as children. The user_5 has editor access to the group child entities channels, things, and groups. In this case, user_5 has editor access to group_101, and also has edit access to its child entities channel_101 and thing_101</strong></p>
<p><img alt="group_users_editor" src="../diagrams/group_users_editor.svg" /></p>
<h3 id="group-viewer">Group Viewer<a class="headerlink" href="#group-viewer" title="Permanent link">#</a></h3>
<p>Group viewer users have access to view group and also have access to view all of its child entities</p>
<p><strong>When domain member user_6 becomes a viewer of group_101, user_6 can able to view all the child and nested child entities in group_101. user_6 can assign child entities under group_101 and also assign child entities under any other group and channels that are children of group_101.</strong></p>
<p><img alt="group_users_viewer" src="../diagrams/group_users_viewer.svg" /></p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">#</a></h2>
<h3 id="domain-viewer-with-channel-thing">Domain Viewer with Channel &amp; Thing<a class="headerlink" href="#domain-viewer-with-channel-thing" title="Permanent link">#</a></h3>
<p>user_6 creates new channel and thing with the names channel_201 and thing_201 respectively. Then connects both channel_201 and thing_201.</p>
<p><img alt="group_users_viewer_1" src="../diagrams/group_users_viewer_1.svg" /></p>
<p>Now user_5 can able to assign group_101 as a parent for channel_201</p>
<p><img alt="group_users_viewer_2" src="../diagrams/group_users_viewer_2.svg" /></p>
<p>When channel_201 was assigned as a child of group_101, all the administrators, editors, and viewers of group_101 got the same access (relation) to channel_201 and thing_201</p>
<p><img alt="group_users_viewer_3" src="../diagrams/group_users_viewer_3.svg" /></p>
<h3 id="multiple-domain-members-with-group-channel-thing">Multiple Domain Members with Group, Channel &amp; Thing<a class="headerlink" href="#multiple-domain-members-with-group-channel-thing" title="Permanent link">#</a></h3>
<p>user_8 creates a new group with the name group_301
user_9 creates a new thing and channel with the names thing_301 and channel_301 respectively, then connects both thing and channel.
<img alt="group_users_member_11" src="../diagrams/group_users_member_11.svg" /></p>
<p>user_8 can able to assign channel_301 as a child of group_301
<img alt="group_users_member_12" src="../diagrams/group_users_member_12.svg" />
When channel_301 is assigned as a child of group_301, then the administrators, editors, and viewers of group_301 get the same respective access to channel_301.
The administrator, editor, and viewer of channel_301 get the same respective access to thing_301.
So here user_8 becomes the administrator of both channel_301 and thing_301</p>
<p>user_5 can able to assign group_301 as a child of group_101
<img alt="group_users_member_13" src="../diagrams/group_users_member_13.svg" /></p>
<p>When group_301 becomes a child of group_101, then the administrator, editor, and viewer of group_101 get the same respective access to group_301.
The administrator, editor, and viewer of group_301 get the same respective access to channel_301.
The administrator, editor, and viewer of channel_301 get the same respective access to thing_301.
So here user_5 becomes the editor of group_301, channel_301, and thing_301, user_4 becomes administrator of group_301, channel_301, and thing_301.
user_8 has administrator access only to group_301 and its child entities channel_301 and thing_301.
<img alt="group_users_member_14" src="../diagrams/group_users_member_14.svg" /></p>
<h2 id="user-registration">User Registration<a class="headerlink" href="#user-registration" title="Permanent link">#</a></h2>
<p>There are two ways to user get registered to Magistrala, self-register and register new users by super admin.
User registration is self register default which can be changed by following environment variable:</p>
<div class="highlight"><pre><span></span><code>SMQ_USERS_ALLOW_SELF_REGISTER=true
</code></pre></div>
<h2 id="magistrala-personal-access-token-pat-authentication">Magistrala Personal Access Token (PAT) Authentication<a class="headerlink" href="#magistrala-personal-access-token-pat-authentication" title="Permanent link">#</a></h2>
<h3 id="pat-overview">PAT Overview<a class="headerlink" href="#pat-overview" title="Permanent link">#</a></h3>
<p>Personal Access Tokens (PATs) in Magistrala provide a secure method for authentication and authorization, similar to JSON Web Tokens (JWTs). PATs enable fine-grained access control with customizable scopes and permissions.</p>
<h3 id="pat-fields">PAT Fields<a class="headerlink" href="#pat-fields" title="Permanent link">#</a></h3>
<p>PATs have the following fields:</p>
<ul>
<li>ID: Unique identifier for the token</li>
<li>User: User ID associated with the token</li>
<li>Name: User-defined name for easy identification</li>
<li>Description: Explanation of the token's purpose</li>
<li>Secret: Securely hashed token for authentication</li>
<li>Scope: Defines the precise permissions and access levels</li>
<li>IssuedAt: Timestamp of token creation</li>
<li>ExpiresAt: Timestamp when the token becomes invalid</li>
<li>UpdatedAt: Last modification timestamp</li>
<li>LastUsedAt: Timestamp of most recent token usage</li>
<li>Revoked: Boolean indicating token's active/inactive status</li>
<li>RevokedAt: Timestamp of token revocation</li>
</ul>
<h3 id="scope-structure">Scope Structure<a class="headerlink" href="#scope-structure" title="Permanent link">#</a></h3>
<p>The PAT scope defines granular permissions across different system components:</p>
<ul>
<li>Users: Operations that can be performed by users</li>
<li>Domains: Permissions for entities within domains (groups, channels, clients)</li>
<li>Dashboard: Dashboard-related operations</li>
<li>Messaging: Publish and subscribe permissions</li>
</ul>
<h3 id="example-scope-json">Example Scope JSON<a class="headerlink" href="#example-scope-json" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;users&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;create&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;update&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;delete&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;domains&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;domain_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;entities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;groups&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;create&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">// this for all groups in domain</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="c1">// for particular channel in domain</span>
<span class="w">                  </span><span class="nt">&quot;delete&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                      </span><span class="s2">&quot;0241e6fe-2113-4731-9cfa-5c74626652b8&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="p">]</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="nt">&quot;clients&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;update&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">// this for all clients in domain</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pat-endpoint-operations">PAT Endpoint Operations<a class="headerlink" href="#pat-endpoint-operations" title="Permanent link">#</a></h3>
<p>Magistrala exposes a couple of endpoints that allow the user to create,retrieve, update, delete and list pats.</p>
<ul>
<li><strong>Create PAT</strong>:</li>
</ul>
<p>Endpoint: <code>POST http://localhost:9001/pats</code></p>
<p>Example Request:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9001/pats&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer {JWT Token}&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;clients pat&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;for creating any client&quot;,</span>
<span class="s1">    &quot;duration&quot;: &quot;20h&quot;,</span>
<span class="s1">    &quot;scope&quot;: {</span>
<span class="s1">        &quot;domains&quot;: {</span>
<span class="s1">            &quot;{domainID}&quot;: {</span>
<span class="s1">                &quot;entities&quot;: {</span>
<span class="s1">                    &quot;clients&quot;: {</span>
<span class="s1">                      &quot;create&quot;: [</span>
<span class="s1">                          &quot;*&quot;</span>
<span class="s1">                      ]</span>
<span class="s1">                    }</span>
<span class="s1">                }</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<p>Expected response:</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;ec562a21-3341-4776-81ea-165afc2a8a57&quot;</span>,
<span class="w">    </span><span class="s2">&quot;user&quot;</span>:<span class="w"> </span><span class="s2">&quot;1e16c130-6f65-4ee8-80ac-e3ee76854878&quot;</span>,
<span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;clients pat&quot;</span>,
<span class="w">    </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span><span class="s2">&quot;for creating any client&quot;</span>,
<span class="w">    </span><span class="s2">&quot;secret&quot;</span>:<span class="w"> </span><span class="s2">&quot;pat_HhbBMG9lTuiArOPudoVIeOxWKiEzQUd2geoWWvwqilc=_ZdO</span><span class="nv">$M3</span><span class="s2">-DT3Kz32nrLJ2IPY!jakoT9qTlEQ=1mgQC5^Y+hMxtkH%w</span><span class="nv">$mJ5MOy2</span><span class="s2">*Q-^4aTn148n</span><span class="nv">$Zd</span><span class="s2">|fwZssxgaW5@wv=lv!v4EJK%|&quot;</span>,
<span class="w">    </span><span class="s2">&quot;scope&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;domains&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;71133f11-8763-4c43-93b8-852ba7313109&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="s2">&quot;entities&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;clients&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="s2">&quot;create&quot;</span>:<span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;issued_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-06T12:57:32.239599201Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;expires_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-07T08:57:32.239599201Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;updated_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;last_used_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;revoked_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li><strong>Retrieve PAT</strong>:</li>
</ul>
<p>Endpoint: <code>GET http://localhost:9001/pats/{patID}</code></p>
<p>Example Request:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9001/pats/{patID}&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer {JWT Token}&#39;</span>
</code></pre></div>
<p>Expected response:</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;ec562a21-3341-4776-81ea-165afc2a8a57&quot;</span>,
<span class="w">    </span><span class="s2">&quot;user&quot;</span>:<span class="w"> </span><span class="s2">&quot;1e16c130-6f65-4ee8-80ac-e3ee76854878&quot;</span>,
<span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;clients pat&quot;</span>,
<span class="w">    </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span><span class="s2">&quot;for creating any client&quot;</span>,
<span class="w">    </span><span class="s2">&quot;scope&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;domains&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;71133f11-8763-4c43-93b8-852ba7313109&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="s2">&quot;entities&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;clients&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="s2">&quot;create&quot;</span>:<span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;issued_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-06T12:57:32Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;expires_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-07T08:57:32Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;updated_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;last_used_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;revoked_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li><strong>Update PAT</strong>:</li>
</ul>
<p>Endpoint: <code>PATCH http://localhost:9001/pats/{patID}/name</code></p>
<p>Example Request:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span>--request<span class="w"> </span>PATCH<span class="w"> </span><span class="s1">&#39;http://localhost:9001/pats/{patID}/name&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer {JWT Token}&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;new client pat&quot;</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<p>Expected response:</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;ec562a21-3341-4776-81ea-165afc2a8a57&quot;</span>,
<span class="w">    </span><span class="s2">&quot;user&quot;</span>:<span class="w"> </span><span class="s2">&quot;1e16c130-6f65-4ee8-80ac-e3ee76854878&quot;</span>,
<span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;new client pat&quot;</span>,
<span class="w">    </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span><span class="s2">&quot;for creating any client&quot;</span>,
<span class="w">    </span><span class="s2">&quot;scope&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;domains&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;71133f11-8763-4c43-93b8-852ba7313109&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="s2">&quot;entities&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;clients&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="s2">&quot;create&quot;</span>:<span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;issued_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-06T12:57:32Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;expires_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-07T08:57:32Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;updated_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-12-06T16:42:18Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;last_used_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>,
<span class="w">    </span><span class="s2">&quot;revoked_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;0001-01-01T00:00:00Z&quot;</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li><strong>Delete PAT</strong>:</li>
</ul>
<p>Example Request:</p>
<p>Endpoint: DELETE <code>http://localhost:9001/pats/{patID}</code></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span>--request<span class="w"> </span>DELETE<span class="w"> </span><span class="s1">&#39;http://localhost:9001/pats/{patID}&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer {JWT Token}&#39;</span>
</code></pre></div>
<p>With this lets use the PAT token/secret in platform to create a client and channel and connect them.</p>
<p>lets create a PAT that can create any client and channel:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9001/pats&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer {JWT Token}&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;clients &amp; channels pat&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;for creating any client or channel&quot;,</span>
<span class="s1">    &quot;duration&quot;: &quot;20h&quot;,</span>
<span class="s1">    &quot;scope&quot;: {</span>
<span class="s1">        &quot;domains&quot;: {</span>
<span class="s1">            &quot;{domainID}&quot;: {</span>
<span class="s1">                &quot;entities&quot;: {</span>
<span class="s1">                    &quot;clients&quot;: {</span>
<span class="s1">                      &quot;create&quot;: [</span>
<span class="s1">                          &quot;*&quot;</span>
<span class="s1">                      ]</span>
<span class="s1">                    }</span>
<span class="s1">                    &quot;channels&quot;: {</span>
<span class="s1">                      &quot;create&quot;: [</span>
<span class="s1">                          &quot;*&quot;</span>
<span class="s1">                      ]</span>
<span class="s1">                    }</span>
<span class="s1">                }</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<h3 id="authentication-and-authorization-process">Authentication and Authorization Process<a class="headerlink" href="#authentication-and-authorization-process" title="Permanent link">#</a></h3>
<ol>
<li><strong>Authentication</strong>: The system first verifies that the PAT was legitimately issued by the platform.</li>
<li><strong>Authorization</strong>: The system then checks if the requested API operation is permitted by the token's defined scope.</li>
</ol>
<p>Example of Using PAT</p>
<ul>
<li>Creating a client using PATs:</li>
</ul>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9006/{domainID}/clients&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;accept: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer pat_HhbBMG9lTuiArOPudoVIeEvY94LEeE86jgoIzvk3vDs=_wdRegJONu9SpmfjS^tDy0$fG-2jp&amp;$^yLgQr5Fse@eb6IBCatDv-R+4#Tpc%dHomiWN%NKYe6|J40KTYnmXmG-NAVNlogw*U4%!Q&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;name&quot;: &quot;client&quot;,</span>
<span class="s1">  &quot;tags&quot;: [</span>
<span class="s1">    &quot;tag1&quot;,</span>
<span class="s1">    &quot;tag2&quot;</span>
<span class="s1">  ],</span>
<span class="s1">  &quot;metadata&quot;:{&quot;units&quot;:&quot;km&quot;},</span>
<span class="s1">  &quot;status&quot;: &quot;enabled&quot;</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<ul>
<li>Creating a channel using PATs:</li>
</ul>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9005/{domainID}/channels&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;accept: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer pat_HhbBMG9lTuiArOPudoVIeEvY94LEeE86jgoIzvk3vDs=_wdRegJONu9SpmfjS^tDy0$fG-2jp&amp;$^yLgQr5Fse@eb6IBCatDv-R+4#Tpc%dHomiWN%NKYe6|J40KTYnmXmG-NAVNlogw*U4%!Q&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;name&quot;: &quot;channel&quot;,</span>
<span class="s1">  &quot;description&quot;: &quot;long channel description&quot;,</span>
<span class="s1">  &quot;metadata&quot;: {</span>
<span class="s1">    &quot;location&quot;: &quot;London&quot;</span>
<span class="s1">  },</span>
<span class="s1">  &quot;status&quot;: &quot;enabled&quot;</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<ul>
<li>Connecting both using the created PAT:</li>
</ul>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>--location<span class="w"> </span><span class="s1">&#39;http://localhost:9005/{domainID}/channels/connect&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer pat_6ofqnFdFTH2qbgzDl8Dhn07ode5Sgk4BsCR1qgzFJoo=_9u=^tyQn0aJ$Jco1ZvJnPizYaN1W|Ij5F4y0A=MQr&amp;cBQ*Woa4DI7GBn&amp;E6BDFLgXDpb-Og@h1rWshzFtn7K4PTq|A*5+g1aiwQj&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;client_ids&quot;: [&quot;{clientID}&quot;],</span>
<span class="s1">    &quot;channel_ids&quot;: [&quot;{channelID}&quot;],</span>
<span class="s1">    &quot;types&quot;: &quot;publish&quot;</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<h4 id="example-of-authorization-failure">Example of Authorization Failure<a class="headerlink" href="#example-of-authorization-failure" title="Permanent link">#</a></h4>
<p>If the PAT used above with client and channel creation permissions attempts to create a group, the request will be denied and
the expected is error:</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;error&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;failed to authorize PAT&quot;</span>
<span class="o">}</span>
</code></pre></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) Abstract Machines
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>